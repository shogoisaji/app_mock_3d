# 動画保存機能の追加に関する評価報告書

## 1. 目的

本報告書は、既存の画像保存アプリケーションに動画保存機能を追加することの実現可能性を評価し、その実装方針を提案することを目的とします。

## 2. 調査結果

現在のアプリケーションのコードベースを調査した結果、動画保存機能の追加は**十分に実現可能**であると判断しました。

- **アーキテクチャ**: アプリは `SceneKit` を用いて3Dモデルのレンダリングを行っており、このレンダリング結果を連続的にキャプチャすることで動画を生成できます。
- **画像選択 (`ImagePickerManager`)**: 現在は静止画のみに対応していますが、Appleの `PhotosUI` フレームワークは動画選択もサポートしているため、比較的容易に拡張できます。
- **レンダリング (`RenderingEngine`)**: 現在は `SCNRenderer.snapshot` を利用して単一フレームを画像として書き出しています。これを拡張し、`AVAssetWriter` などのAPIを用いて複数フレームを連続的にレンダリングし、ビデオファイルとしてエンコードする機能の追加が必要です。
- **保存処理 (`PhotoSaveManager`)**: 現在は `UIImage` オブジェクトをフォトライブラリに保存しています。動画の場合は、生成されたビデオファイルのURLを渡し、`PHPhotoLibrary` を使って保存するよう変更する必要があります。

## 3. 実装方針案

最も現実的で効果的な初期実装として、**3Dモデルのターンテーブルアニメーション動画**を生成する機能を提案します。これは、ユーザーがテクスチャを適用した3Dモデルが360度回転する短いビデオクリップを作成するものです。

具体的な実装ステップは以下の通りです。

1.  **動画レンダリング機能の実装 (`RenderingEngine.swift`)**:
    -   `AVAssetWriter` を利用して、SceneKitのレンダリング結果をフレームごとにビデオファイルに書き込むロジックを構築します。
    -   カメラまたは3Dモデルを時間経過とともに回転させ、アニメーションを生成します。

2.  **UIの変更 (`ExportView.swift`)**:
    -   既存のエクスポート画面に「ビデオとして保存」ボタンを追加します。
    -   このボタンが押された際に、上記の動画レンダリング処理を呼び出すようにします。

3.  **動画保存機能の実装 (`PhotoSaveManager.swift`)**:
    -   レンダリング処理によって生成されたビデオファイル（一時ディレクトリに保存）を受け取り、ユーザーのフォトライブラリに保存する機能を追加します。

4.  **機能の統合**:
    -   UIのボタン操作から、レンダリング、そして最終的な保存までの一連の流れをスムーズに連携させます。

## 4. 結論

本プロジェクトのコードベースは拡張性が高く、計画的な開発アプローチを取ることで、品質を維持しながら動画保存機能を効率的に追加できる見込みです。上記の実装方針に従い、開発を進めることを推奨します。
